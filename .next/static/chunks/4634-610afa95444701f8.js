(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4634],{283:(e,t,s)=>{"use strict";s.d(t,{A:()=>u,AuthProvider:()=>n});var a=s(5155),i=s(2115),l=s(2643),r=s(6526);let o=(0,i.createContext)(void 0);function n(e){let{children:t}=e,[s,n]=(0,i.useState)(null),[u,c]=(0,i.useState)(null),[d,h]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{console.log("\uD83D\uDD04 Getting initial session...");try{var e,t;let{data:{session:s},error:a}=await l.N.auth.getSession();a?console.error("❌ Error getting session:",a):console.log("✅ Initial session loaded:",{user:(null==s||null==(e=s.user)?void 0:e.email)||"none",session:s?"present":"missing",accessToken:(null==s?void 0:s.access_token)?"present":"missing"}),c(s),n(null!=(t=null==s?void 0:s.user)?t:null)}catch(e){console.error("❌ Unexpected error getting session:",e)}finally{h(!1)}})();let{data:{subscription:e}}=l.N.auth.onAuthStateChange(async(e,t)=>{var s,a;console.log("\uD83D\uDD04 Auth state change:",{event:e,user:(null==t||null==(s=t.user)?void 0:s.email)||"none",session:t?"present":"missing"}),c(t),n(null!=(a=null==t?void 0:t.user)?a:null),h(!1)});return()=>e.unsubscribe()},[]);let p=async(e,t,s)=>{var a;let i=await l.N.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if((null==(a=i.data)?void 0:a.user)&&!i.error){if(s&&Object.keys(s).length>0)try{await r.p.createProfile(i.data.user.id,s),console.log("✅ Profile created successfully")}catch(e){console.error("❌ Error creating profile:",e)}i.data.session||console.log("\uD83D\uDCE7 Email confirmation required for:",e)}return i},g=async(e,t)=>await l.N.auth.signInWithPassword({email:e,password:t}),m=async()=>await l.N.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}}),_=async()=>await l.N.auth.signOut();return(0,a.jsx)(o.Provider,{value:{user:s,session:u,loading:d,signUp:p,signIn:g,signInWithGoogle:m,signOut:_,isGuest:!s},children:t})}function u(){let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2643:(e,t,s)=>{"use strict";let a;s.d(t,{N:()=>l});var i=s(1916);let l=function(){if(a)return a;let e="https://pqfsbxcbsxuyfgqrxdob.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxZnNieGNic3h1eWZncXJ4ZG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc5NDk4MDAsImV4cCI6MjA2MzUyNTgwMH0.RH_VQLoTOdAauUciYWC39Wto1ZmK28gWjQ9eWJ0FEGU";if(!e||!t)throw Error("Missing Supabase environment variables. Please check NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your .env.local file.");return a=(0,i.createBrowserClient)(e,t)}()},4634:(e,t,s)=>{"use strict";s.d(t,{U:()=>c});var a=s(5155),i=s(2115),l=s(760),r=s(6408),o=s(283),n=s(8692),u=s.n(n);let c=e=>{let{isOpen:t,onClose:s,mode:n="signin",title:c="Welcome to Mystic Arcana",subtitle:d="Sign in to unlock your personalized journey"}=e,[h,p]=(0,i.useState)(n);i.useEffect(()=>{t&&(p(n),m(""),f(""),y(""),v(""),j(""),k(null))},[t,n]);let[g,m]=(0,i.useState)(""),[_,f]=(0,i.useState)(""),[b,y]=(0,i.useState)(""),[N,v]=(0,i.useState)(""),[x,j]=(0,i.useState)(""),[w,A]=(0,i.useState)(!1),[C,k]=(0,i.useState)(null),[S,B]=(0,i.useState)(null),{signIn:M,signUp:P,signInWithGoogle:E}=(0,o.A)(),I=async e=>{e.preventDefault(),A(!0),k(null),B(null);try{if("signin"===h){let{error:e}=await M(g,_);e?k(e.message):s()}else{let e={};b&&(e.birth_date=b),N&&(e.birth_time=N),x&&(e.birth_location=x);let{data:t,error:a}=await P(g,_,e);a?k(a.message):(null==t?void 0:t.user)&&!t.session?(B("Check your email to confirm your account!"),m(""),f(""),y(""),v(""),j("")):(null==t?void 0:t.session)&&s()}}catch(e){k("An unexpected error occurred")}finally{A(!1)}},G=async()=>{A(!0),k(null);try{let{error:e}=await E();e&&k(e.message)}catch(e){k("Failed to sign in with Google")}finally{A(!1)}},F=()=>{p("signin"===h?"signup":"signin"),k(null)};return(0,a.jsx)(l.N,{children:t&&(0,a.jsx)(r.P.div,{className:u().backdrop,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e=>{e.target===e.currentTarget&&s()},children:(0,a.jsxs)(r.P.div,{className:u().modal,initial:{opacity:0,scale:.8,y:50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:50},transition:{type:"spring",damping:25,stiffness:300},onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:u().closeButton,onClick:s,"aria-label":"Close modal",children:"\xd7"}),(0,a.jsxs)("div",{className:u().header,children:[(0,a.jsx)("h2",{className:u().title,children:c}),(0,a.jsx)("p",{className:u().subtitle,children:d})]}),(0,a.jsxs)("form",{onSubmit:I,className:u().form,children:[(0,a.jsxs)("div",{className:u().inputGroup,children:[(0,a.jsx)("label",{htmlFor:"email",className:u().label,children:"Email"}),(0,a.jsx)("input",{id:"email",type:"email",value:g,onChange:e=>m(e.target.value),className:u().input,placeholder:"Enter your email",required:!0})]}),(0,a.jsxs)("div",{className:u().inputGroup,children:[(0,a.jsx)("label",{htmlFor:"password",className:u().label,children:"Password"}),(0,a.jsx)("input",{id:"password",type:"password",value:_,onChange:e=>f(e.target.value),className:u().input,placeholder:"Enter your password",required:!0,minLength:6})]}),"signup"===h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:u().inputGroup,children:[(0,a.jsx)("label",{htmlFor:"birthDate",className:u().label,children:"Birth Date"}),(0,a.jsx)("input",{id:"birthDate",type:"date",value:b,onChange:e=>y(e.target.value),className:u().input,required:!0})]}),(0,a.jsxs)("div",{className:u().inputGroup,children:[(0,a.jsx)("label",{htmlFor:"birthTime",className:u().label,children:"Birth Time (Optional)"}),(0,a.jsx)("input",{id:"birthTime",type:"time",value:N,onChange:e=>v(e.target.value),className:u().input})]}),(0,a.jsxs)("div",{className:u().inputGroup,children:[(0,a.jsx)("label",{htmlFor:"birthLocation",className:u().label,children:"Birth Location (Optional)"}),(0,a.jsx)("input",{id:"birthLocation",type:"text",value:x,onChange:e=>j(e.target.value),className:u().input,placeholder:"City, Country"})]})]}),C&&(0,a.jsx)("div",{className:u().error,role:"alert",children:C}),S&&(0,a.jsx)("div",{className:u().success,role:"alert",children:S}),(0,a.jsx)("button",{type:"submit",className:u().submitButton,disabled:w||!!S,children:w?"Loading...":"signin"===h?"Sign In":"Sign Up"})]}),(0,a.jsx)("div",{className:u().divider,children:(0,a.jsx)("span",{children:"or"})}),(0,a.jsxs)("button",{type:"button",onClick:G,className:u().googleButton,disabled:w,children:[(0,a.jsx)("span",{className:u().googleIcon,children:"G"}),"Continue with Google"]}),(0,a.jsx)("div",{className:u().footer,children:"signin"===h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:["Don't have an account?"," ",(0,a.jsx)("button",{type:"button",onClick:F,className:u().linkButton,children:"Sign up"})]}),(0,a.jsx)("p",{className:u().forgotPassword,children:(0,a.jsx)("a",{href:"/auth/reset-password",className:u().linkButton,children:"Forgot your password?"})})]}):(0,a.jsxs)("p",{children:["Already have an account?"," ",(0,a.jsx)("button",{type:"button",onClick:F,className:u().linkButton,children:"Sign in"})]})})]})})})}},6526:(e,t,s)=>{"use strict";s.d(t,{p:()=>i});var a=s(2643);let i={async createProfile(e,t){let{data:s,error:i}=await a.N.from("user_profiles").insert([{user_id:e,...t}]).select().single();if(i)throw console.error("Error creating profile:",i),i;return s},async updateProfile(e,t){let{data:s,error:i}=await a.N.from("user_profiles").update(t).eq("user_id",e);if(i)throw console.error("Error updating profile:",i),i;return s},async getProfile(e){try{let{data:t,error:s}=await a.N.from("user_profiles").select("*").eq("user_id",e).maybeSingle();if(s)throw console.error("Error fetching profile:",s),s;if(!t)return console.log("Creating profile for user ".concat(e)),await this.createProfile(e,{});return t}catch(e){throw console.error("Profile service error:",e),e}}}},8692:e=>{e.exports={backdrop:"AuthModal_backdrop__E_vjX",modal:"AuthModal_modal__7Ph6j",closeButton:"AuthModal_closeButton__Jugdv",header:"AuthModal_header__ZF0q9",title:"AuthModal_title__rlHlr",subtitle:"AuthModal_subtitle__dZ_Yg",form:"AuthModal_form__y8L_8",inputGroup:"AuthModal_inputGroup__aBBEo",label:"AuthModal_label__9F9Hu",input:"AuthModal_input__Vcf7N",error:"AuthModal_error__LlxgV",success:"AuthModal_success__Cplsg",submitButton:"AuthModal_submitButton__pwpua",divider:"AuthModal_divider__hXF3G",googleButton:"AuthModal_googleButton__fbfPl",googleIcon:"AuthModal_googleIcon__ligd4",footer:"AuthModal_footer__ostx6",linkButton:"AuthModal_linkButton__fw2TK",forgotPassword:"AuthModal_forgotPassword__Z9Zdz"}}}]);