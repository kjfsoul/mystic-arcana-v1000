(()=>{var e={};e.id=7649,e.ids=[7649],e.modules={2507:(e,r,t)=>{"use strict";t.d(r,{U:()=>i});var s=t(34386),a=t(44999);async function i(){let e=await (0,a.UL)(),r="https://pqfsbxcbsxuyfgqrxdob.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxZnNieGNic3h1eWZncXJ4ZG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc5NDk4MDAsImV4cCI6MjA2MzUyNTgwMH0.RH_VQLoTOdAauUciYWC39Wto1ZmK28gWjQ9eWJ0FEGU";if(!r||!t){if("phase-production-build"===process.env.NEXT_PHASE)return console.warn("Supabase environment variables not available during build. Using mock client."),null;throw Error("Missing Supabase environment variables. Please check NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your .env.local file.")}return(0,s.createServerClient)(r,t,{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>e.set(r,t,s))}catch{}}}})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},54699:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>u});var a=t(96559),i=t(48088),n=t(37719),o=t(2507),c=t(32190);let d=new(t(86481)).A("TarotDeckAPI");async function u(e,{params:r}){let t=Date.now();try{let{deckId:e}=await r;if(!e||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return d.warn("invalid_deck_id_format",void 0,{deckId:e},`Invalid deck ID format: ${e}`),c.NextResponse.json({error:"Invalid deck ID format",message:"Deck ID must be a valid UUID",code:"INVALID_DECK_ID"},{status:400});d.info("fetching_tarot_deck",void 0,{deckId:e},`Fetching deck: ${e}`);let s=await (0,o.U)(),{data:a,error:i}=await s.from("decks").select("id, name, description, image_url, is_active").eq("id",e).eq("is_active",!0).single();if(i||!a)return d.error("tarot_deck_fetch_error",void 0,{},Error(i?.message||"Unknown error"),`Deck fetch error for ${e}.`),c.NextResponse.json({error:"Deck not found or inactive",message:"The requested deck does not exist or has been deactivated",code:"DECK_NOT_FOUND",deckId:e},{status:404});let{data:n,error:u}=await s.from("cards").select(`
        id,
        name,
        card_number,
        suit,
        arcana_type,
        meaning_upright,
        meaning_reversed,
        image_url,
        keywords
      `).eq("deck_id",e).order("arcana_type",{ascending:!0}).order("card_number",{ascending:!0});if(u)return d.error("tarot_cards_fetch_error",void 0,{},Error(u?.message||"Unknown error"),`Cards fetch error for deck ${e}.`),c.NextResponse.json({error:"Failed to fetch cards",message:"Unable to retrieve cards for this deck",code:"CARDS_FETCH_ERROR",deckId:e},{status:500});let l=n?.map(e=>({id:`${e.card_number}-${e.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}`,name:e.name,arcana:e.arcana_type,suit:e.suit,number:e.card_number,frontImage:e.image_url,backImage:"/images/tarot/card-back.svg",meaning:{upright:e.meaning_upright,reversed:e.meaning_reversed,keywords:e.keywords||[]},description:`${e.name} represents ${e.meaning_upright.toLowerCase()}.`}))||[],p=l.filter(e=>"major"===e.arcana),m=l.filter(e=>"minor"===e.arcana),g={deck:{id:a.id,name:a.name,description:a.description,imageUrl:a.image_url},cards:l,stats:{totalCards:l.length,majorArcana:p.length,minorArcana:m.length,suits:{cups:l.filter(e=>"cups"===e.suit).length,pentacles:l.filter(e=>"pentacles"===e.suit).length,swords:l.filter(e=>"swords"===e.suit).length,wands:l.filter(e=>"wands"===e.suit).length}}},h=Date.now()-t;return d.info("tarot_deck_fetched",void 0,{deckId:e,cardCount:l.length,responseTime:h},`Successfully fetched deck ${e} with ${l.length} cards.`),c.NextResponse.json(g,{headers:{"Cache-Control":"public, max-age=3600, stale-while-revalidate=86400","X-Response-Time":`${h}ms`,"X-Cards-Count":l.length.toString()}})}catch(s){let e=Date.now()-t;return d.error("tarot_deck_api_internal_error",void 0,{deckId:(await r).deckId,responseTime:e},s,"An unexpected error occurred in the Tarot Deck API."),c.NextResponse.json({error:"Internal server error",message:"An unexpected error occurred while processing your request",code:"INTERNAL_ERROR"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/tarot/deck/[deckId]/route",pathname:"/api/tarot/deck/[deckId]",filename:"route",bundlePath:"app/api/tarot/deck/[deckId]/route"},resolvedPagePath:"/Users/kfitz/mystic-arcana-v1000/src/app/api/tarot/deck/[deckId]/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:m,serverHooks:g}=l;function h(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:m})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},86481:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});class s{constructor(e){this.serviceName=e}log(e,r,t,s,a,i){let n={timestamp:new Date().toISOString(),level:e,service:this.serviceName,action:r,userId:t,metadata:s,message:a};i&&(n.error={name:i.name,message:i.message,stack:i.stack}),console.log(JSON.stringify(n))}debug(e,r,t,s){this.log("DEBUG",e,r,t,s)}info(e,r,t,s){this.log("INFO",e,r,t,s)}warn(e,r,t,s){this.log("WARN",e,r,t,s)}error(e,r,t,s,a){this.log("ERROR",e,r,t,a,s)}}let a=s},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,6437,3410],()=>t(54699));module.exports=s})();