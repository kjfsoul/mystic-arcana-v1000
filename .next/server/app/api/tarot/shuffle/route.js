(()=>{var e={};e.id=4984,e.ids=[4984],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},39727:()=>{},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47990:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},86481:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});class s{constructor(e){this.serviceName=e}log(e,t,r,s,o,a){let n={timestamp:new Date().toISOString(),level:e,service:this.serviceName,action:t,userId:r,metadata:s,message:o};a&&(n.error={name:a.name,message:a.message,stack:a.stack}),console.log(JSON.stringify(n))}debug(e,t,r,s){this.log("DEBUG",e,t,r,s)}info(e,t,r,s){this.log("INFO",e,t,r,s)}warn(e,t,r,s){this.log("WARN",e,t,r,s)}error(e,t,r,s,o){this.log("ERROR",e,t,r,o,s)}}let o=s},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},95069:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>m,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>h});var o=r(96559),a=r(48088),n=r(37719),u=r(86481),i=r(66437),c=r(32190);let l=new u.A("TarotShuffleAPI");async function h(e){try{let t,{deckId:r="00000000-0000-0000-0000-000000000001",algorithm:s="fisher-yates",includePreview:o=!1,userId:a}=await e.json(),n="https://pqfsbxcbsxuyfgqrxdob.supabase.co",u=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!n||!u)return c.NextResponse.json({success:!1,error:"Database configuration error",code:"CONFIG_ERROR"},{status:500});let h=(0,i.UU)(n,u,{auth:{autoRefreshToken:!1,persistSession:!1}}),p=Date.now(),{data:d,error:f}=await h.from("cards").select("*").eq("deck_id",r).order("card_number");if(f)return console.error("Database fetch error:",f),c.NextResponse.json({success:!1,error:"Failed to fetch deck cards",code:"FETCH_ERROR",details:f.message},{status:500});if(!d||0===d.length)return c.NextResponse.json({success:!1,error:`No cards found for deck ${r}`,code:"DECK_NOT_FOUND"},{status:404});let g=function(e,t){let r=[...e];switch(t){case"fisher-yates":default:var s=r;let o=[...s];for(let e=o.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[o[e],o[t]]=[o[t],o[e]]}return o;case"riffle":return function(e){let t=[...e],r=Math.floor(t.length/2),s=t.slice(0,r),o=t.slice(r),a=[],n=0,u=0;for(;n<s.length&&u<o.length;).6>Math.random()?a.push(s[n++]):a.push(o[u++]);return a.push(...s.slice(n),...o.slice(u)),a}(r);case"overhand":return function(e){let t=[...e],r=3+Math.floor(3*Math.random());for(let e=0;e<r;e++){let e=[];for(;t.length>0;){let r=Math.min(t.length,1+Math.floor(6*Math.random())),s=t.splice(0,r);e.unshift(...s)}t=e}return t}(r)}}(d,s),m=Date.now()-p,x=`shuffle_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,R=function(e){let t=0,r=e.length;for(let s=0;s<r;s++){let o=e[s].card_number;t+=Math.abs(s-o)/r}return t/r}(g),v={algorithm:s,timestamp:new Date().toISOString(),entropy:Math.round(100*R)/100};o&&g.length>=3&&(t={topCard:{name:g[0].name,arcana:g[0].arcana_type,suit:g[0].suit},middleCard:{name:g[Math.floor(g.length/2)].name,arcana:g[Math.floor(g.length/2)].arcana_type,suit:g[Math.floor(g.length/2)].suit},bottomCard:{name:g[g.length-1].name,arcana:g[g.length-1].arcana_type,suit:g[g.length-1].suit}});let y={success:!0,shuffleId:x,deckId:r,cardCount:g.length,shuffleState:v,...t&&{preview:t}};return l.info("tarot_deck_shuffled",a,{deckId:r,algorithm:s,cardCount:g.length,shuffleTime:m,entropy:v.entropy,shuffleId:x},`Successfully shuffled ${g.length} cards using ${s} algorithm.`),c.NextResponse.json(y,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate","X-Shuffle-Time":m.toString(),"X-Shuffle-ID":x,"X-Entropy":R.toString()}})}catch(e){return console.error("Tarot shuffle error:",e),c.NextResponse.json({success:!1,error:"Internal server error",code:"INTERNAL_ERROR",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/tarot/shuffle/route",pathname:"/api/tarot/shuffle",filename:"route",bundlePath:"app/api/tarot/shuffle/route"},resolvedPagePath:"/Users/kfitz/mystic-arcana-v1000/src/app/api/tarot/shuffle/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:f,serverHooks:g}=p;function m(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:f})}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,6437],()=>r(95069));module.exports=s})();